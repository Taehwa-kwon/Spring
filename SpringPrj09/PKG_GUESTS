create or replace PACKAGE PKG_GUESTS AS 

    --전체조회
  PROCEDURE PROC_GUESTS_LIST(
    O_CUR OUT SYS_REFCURSOR
  );
    --추가
  PROCEDURE PROC_GUESTS_INSERT(
    IN_TITLE IN VARCHAR2,
    IN_NAME IN VARCHAR2
    
  );
   --개인조회
  PROCEDURE PROC_GUESTS_VIEW(
    IN_IDX IN NUMBER,
    O_CUR OUT SYS_REFCURSOR
  );
  
  
   --삭제
  PROCEDURE PROC_GUESTS_DELETE(
    IN_IDX IN NUMBER
    
  );
  --업데이트
  PROCEDURE PROC_GUESTS_UPDATE(
    IN_IDX IN NUMBER,
    IN_TITLE IN VARCHAR2,
    IN_NAME IN VARCHAR2
  );

END PKG_GUESTS;


================================================================================


create or replace PACKAGE BODY PKG_GUESTS AS
    --조회
  PROCEDURE PROC_GUESTS_LIST(
    O_CUR OUT SYS_REFCURSOR
  ) AS
  BEGIN
     OPEN O_CUR FOR
        SELECT   IDX, TITLE, NAME, REGDATE,COUNT
        FROM     GUESTS
        ORDER BY IDX DESC;
   
  END PROC_GUESTS_LIST;
  
  --추가
  PROCEDURE PROC_GUESTS_INSERT(
    IN_TITLE IN VARCHAR2,
    IN_NAME IN VARCHAR2
    
  ) AS
  BEGIN
    INSERT INTO GUESTS (IDX,TITLE,NAME, REGDATE)
    VALUES( 
        (SELECT NVL(MAX(IDX),0)+1 FROM GUESTS),
        IN_TITLE,
        IN_NAME,
        SYSDATE
    );
    
  END PROC_GUESTS_INSERT;

    --개인조회
  PROCEDURE PROC_GUESTS_VIEW(
    IN_IDX IN NUMBER,
    O_CUR OUT SYS_REFCURSOR
  ) AS
  BEGIN
    OPEN O_CUR FOR
    SELECT IDX,TITLE,NAME, TO_CHAR(REGDATE,'YYYY-MM-DD HH24:MI:SS DAY') AS REGDATE
    FROM GUESTS
    WHERE IDX = IN_IDX
    ;
    
  END PROC_GUESTS_VIEW;
    
    --삭제
  PROCEDURE PROC_GUESTS_DELETE(
    IN_IDX IN NUMBER
    
  ) AS
  BEGIN
     DELETE FROM GUESTS
     WHERE IDX = IN_IDX;
    
  END PROC_GUESTS_DELETE;

    --업데이트
  PROCEDURE PROC_GUESTS_UPDATE(
    IN_IDX IN NUMBER,
    IN_TITLE IN VARCHAR2,
    IN_NAME IN VARCHAR2
  ) AS
  BEGIN
    UPDATE GUESTS
    SET TITLE=IN_TITLE , NAME=IN_NAME
    WHERE IDX = IN_IDX
    ;
    
  END PROC_GUESTS_UPDATE;

END PKG_GUESTS;